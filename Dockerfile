FROM node:20-bookworm-slim AS deps\nWORKDIR /app\nCOPY package.json package-lock.json* yarn.lock* pnpm-lock.yaml* ./\nRUN \\\n  if [ -f package-lock.json ]; then npm ci; \\\n  elif [ -f yarn.lock ]; then yarn install --frozen-lockfile; \\\n  elif [ -f pnpm-lock.yaml ]; then corepack enable && pnpm i --frozen-lockfile; \\\n  else npm i; fi\n\nFROM node:20-bookworm-slim AS builder\nWORKDIR /app\nCOPY --from=deps /app/node_modules ./node_modules\nCOPY . .\nRUN npx prisma generate && npm run build\n\nFROM node:20-bookworm-slim AS runner\nWORKDIR /app\nENV NODE_ENV=production\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/prisma ./prisma\nCOPY --from=builder /app/src/docs/openapi.yaml ./src/docs/openapi.yaml\nCOPY docker/entrypoint.sh /entrypoint.sh\nRUN chmod +x /entrypoint.sh\nEXPOSE 4000\nCMD ["/entrypoint.sh"]\n